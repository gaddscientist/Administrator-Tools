<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Links fontawesome icons to html file -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
    <!-- Links google font -->
    <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
    <!-- Personal Styles -->
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" media="screen and (max-width: 768px)" href="css/mobile.css">
    <link rel="stylesheet" media="screen and (min-width: 1100px)" href="css/widescreen.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" integrity="sha256-PHcOkPmOshsMBC+vtJdVr5Mwb7r0LkSVJPlPrp/IMpU=" crossorigin="anonymous" />

    <title>Capstone</title>
</head>
<body>
  <!-- Header -->
  <header id="header-reportWriter">
    <div class="container">
      <nav id="main-nav">
        
        <ul>
          <li><img src="img/vcu_logo.png" alt="Capstone" id="logo" /></li>
          <li><a href="index.html" >Home</a></li>
          <li><a href="#">Bidding</a></li>
          <li><a href="#">Budgeting</a></li>
          <li><a href="reportWriter.html" class="current">Reports</a></li>
        </ul>
      </nav>
      <div class="header-content">
      </div>
      <header class="title"> Report </header>
        <button class="button" onClick="exportTableToCSV('Capstone_Report.csv')">Download</button>
    </div>
  </header>
  <div id="output-table"></div>
  <script>
    var x ="<table class='table table-bordered table-hover'> <thead> <tr>", i;
    data = localStorage.getItem("label");
    localStorage.clear();
    data = JSON.parse(data)
    for (const header in data[0]) {
        x = x + "<th>" + header + "</th>";
    }
    x = x + "</tr> </thead>"
    for (i=0; i<data.length; i++) {
        x = x + "<tr>"
        for (const header in data[i]) {
        x = x + "<td>" + data[i][header] + "</td>"
        }
        x = x + "</tr>"
    }
    x = x + "</table"; 

    //dowload to csv file
    function downloadCSV(csv, filename) {
    var csvFile;
    var downloadLink;

    csvFile = new Blob([csv], {type: "text/csv"});
    downloadLink = document.createElement("a");
    downloadLink.download = filename;

    // Create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Add the link to DOM
    document.body.appendChild(downloadLink);
    downloadLink.click();
}

function exportTableToCSV(filename) {
    var csv = [];
    var rows = document.querySelectorAll("table tr");
    
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");
        for (var j = 0; j < cols.length; j++) 
            row.push(cols[j].innerText);
        csv.push(row.join(","));        
    }
    // Download CSV file
    downloadCSV(csv.join("\n"), filename);
}

    console.log(x)
    document.getElementById("output-table").innerHTML = x;
    </script>
  <!-- Footer -->
  <footer id="main-footer">
    <div class="footer-content container">
      <p>Created by Netta Paulson, Shekinah Veeravalli, Bryan Hilldrup, and Asish Boyapati</p>
      <p>Copyright &copy; 2020</p>
    </div>
  </footer>
</body>
<script>
// window.onload = function() {
//     // console.log(getParameterByName('data'));
//     console.log(localStorage.getItem("label"));
//     data = localStorage.getItem("label");
//     localStorage.clear();
//     console.log(JSON.parse(data))
// };
function getParameterByName() {
        url = window.location.href;
        console.log(url)
        const start = url.search('=') + 1
        console.log(JSON.parse(url.substring(start, url.length)))
        return url.substring(start, url.length);
}
function getData() {
    data = localStorage.getItem("label");
    localStorage.clear();
    return JSON.parse(data)
}
</script>